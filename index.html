<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>חלוקת הרשאות בוויקיפדיה</title>
  <style>
    body { font-family: sans-serif; direction: rtl; padding: 20px; background: #f4f4f4; }
    h1 { color: #2c3e50; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: right; }
    th { background-color: #f0f0f0; }
    .note { font-size: 0.9em; color: #666; }
  </style>
</head>
<body>

<h1>נתוני הרשאות בוויקיפדיה העברית</h1>
<p class="note">הנתונים נטענים מדף <a href="https://he.wikipedia.org/wiki/ויקיפדיה:בקרת_הרשאות" target="_blank">ויקיפדיה:בקרת הרשאות</a> – יתכן עיכוב קצר בטעינה</p>

<table id="permissions-table">
  <thead>
    <tr>
      <th>הרשאה</th>
      <th>מספר משתמשים</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="2">טוען נתונים...</td></tr>
  </tbody>
</table>

<script>
  async function fetchPermissionData() {
    const res = await fetch("https://he.wikipedia.org/wiki/ויקיפדיה:בקרת_הרשאות", {
      headers: { "Content-Type": "text/html; charset=UTF-8" }
    });
    const text = await res.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(text, "text/html");

    const tableRows = Array.from(doc.querySelectorAll("table.wikitable tbody tr"));
    const permissionData = [];

    for (let row of tableRows) {
      const cells = row.querySelectorAll("td");
      if (cells.length >= 2) {
        const permission = cells[0].innerText.trim();
        const countText = cells[1].innerText.trim().replace(/[^\d]/g, '');
        const count = parseInt(countText) || 0;
        permissionData.push({ permission, count });
      }
    }

    // הצגה בטבלה
    const tbody = document.querySelector("#permissions-table tbody");
    tbody.innerHTML = "";
    permissionData.forEach(({ permission, count }) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${permission}</td><td>${count.toLocaleString()}</td>`;
      tbody.appendChild(tr);
    });
  }

  fetchPermissionData();
</script>

</body>
</html>
